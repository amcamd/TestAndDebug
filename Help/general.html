<!DOCTYPE html>
<html>
<head>
<style>
table, th, td {
    border: 1px solid orange;
    border-collapse: collapse;
}
th, td {
    padding: 5px;
}
</style>
</head>
<body>
<h1>www sites</h1>
<p>
<table>
<tr>
    <td><a href="https://github.com/ROCmSoftwarePlatform/rocBLAS">rocBLAS</a><br></td>
    <td>Github site for rocBLAS</td>
<tr>
    <td><a href="https://rocblas.readthedocs.io/en/latest/">rocBLAS documentation</a><br></td>
    <td>ReadTheDocs site for rocBLAS</td>
</tr><tr>
    <td><a href="https://github.com/ROCmSoftwarePlatform/Tensile">Tensile</a><br></td>
    <td>Github site for https://github.com/ROCmSoftwarePlatform/Tensile</td>
</tr><tr>
    <td><a href="https://github.com/ROCmSoftwarePlatform/hipBLAS">hipBLAS</a><br></td>
    <td>Github site for https://github.com/ROCmSoftwarePlatform/hipBLAS</td>
</tr><tr>
    <td><a href="http://10.236.10.38/">hsUtil</a><br></td>
    <td>Site for Jenkins Continuous Integration testing. http://hsautil.amd.com/job/ROCmSoftwarePlatform/</td>
</tr><tr>
    <td><a href="http://confluence.amd.com/display/BLTZ/Tensile+and+rocBLAS">Confluence</a><br></td>
    <td>Confluence site for internal documents.</td>
</tr><tr>
    <td><a href="https://github.com/amcamd/TestAndDebug">TestAndDebug</a><br></td>
    <td>Site I use for any open but not official code and testing</td>
</tr><tr>
    <td><a href="http://docs.nvidia.com/cuda/cublas/#introduction">cuBLAS</a><br></td>
    <td>cuBLAS</td>
</tr><tr>
    <td><a href="https://github.com/ROCmSoftwarePlatform/hcBLAS">hcBLAS</a><br></td>
    <td>Discontinued blas library developed by MulticoreWare</td>
</tr><tr>
    <td><a href="https://github.com/AMDComputeLibraries/MLOpen">MIOpen</a><br></td>
    <td>AMD Machine Learning</td>
</tr><tr>
    <td><a href="https://bitbucket.org/multicoreware/hipcaffe">hipCaffe</a><br></td>
    <td>Port of UC.Berkeley Caffe machine learning framework</td>
</tr><tr>
    <td><a href="https://github.com/ROCmSoftwarePlatform/DeepBench">Deepbench</a><br></td>
    <td>BaiDu Research GEMM Benchmarks</td>
</tr><tr>
    <td><a href="https://github.com/ecrc/kblas-gpu">KBLAS</a><br></td>
    <td>KAUST BLAS</td>
</tr><tr>
    <td><a href="https://github.com/hyln9/GCNGEMM">hgemm gcngemm</a><br></td>
    <td>https://github.com/hyln9/GCNGEMM</td>
</tr><tr>
    <td><a href="http://32ipi028l5q82yhj72224m8j-wpengine.netdna-ssl.com/wp-content/uploads/2016/08/AMD_GCN3_Instruction_Set_Architecture_rev1.1.pdf">Reference Guide</a><br></td>
    <td>Reference Guide, Gen 3 gfx 2016</td>
</tr><tr>
    <td><a href="https://github.com/CLRX/CLRX-mirror/wiki/GcnIsa">AMD GCN ISA</a><br></td>
    <td>GCN instruction description</td>
</tr><tr>
    <td><a href="http://developer.amd.com/wordpress/media/2017/08/Vega_Shader_ISA_28July2017.pdf">Vega10 ISA</a><br></td>
    <td>Instruct Set Architecture for Vega 10</td>
</tr><tr>
    <td><a href="https://code.visualstudio.com/">Code Visual Studio</a><br></td>
    <td>useful for debugging python code on Linux</td>
</tr><tr>
    <td><a href="https://cmake.org/cmake-tutorial/">Cmake Tutorial</a><br></td>
    <td>Introductory Cmake tutorial</td>
</tr><tr>
    <td><a href="https://www.docker.com">https://www.docker.com</a><br></td>
    <td>Information on docker containers</td>
</tr><tr>
    <td><a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">Editing Github Wiki </a><br></td>
    <td>Useful for editing Github Wiki documents</td>
</tr><tr>
    <td><a href="http://ontrack-internal.amd.com/browse/SWDEV-103388">Jira example</a><br></td>
    <td>An example Jira ticket. Use your Microsoft login credentials</td>
</tr>
</table>


<p>


<h1>Ubuntu setup</h1>

<ul>
  <li><code>uname -a</code>
    <ul>
      <li>print system information, all
    </ul>
  <li><code>lsb_release -a</code>
    <ul>
      <li>print distribution-specific information (Linux Standard Base)
    </ul>
  <li><code>dpkg --list | grep -i rocm</code>
    <ul>
      <li>get rocm package version
    </ul>
  <li><code>/opt/rocm/bin/rocm_agent_enumerator, /opt/rocm/bin/rocminfo, /opt/rocm/bin/hipconfig
      </code>
    <ul>
      <li>device information, rocm information, hip information
    </ul>
  </li>
  <li><code>lspci</code>
    <ul>
      <li>list all PCI devices
    </ul>
  <li><code>sudo apt-get update</code>
    <ul>
      <li>APT package handling utility (Advanced Package Tool).
      <li>Downloads the package lists from the repositories and "updates" them to get information on the newest versions of packages and their dependencies.
    </ul>
  <li><code>sudo apt-get upgrade</code>
    <ul>
      <li>fetch new versions of packages existing on the machine if APT knows about these new versions by way of apt-get update
    </ul>
  <li><code>ip route get 8.8.8.8 | awk '{print $NF; exit}'</code>
    <ul>
      <li>get the ip address, alternative command is ifconfig
    </ul>
  <li><code>sudo lsblk, sudo blkid, ls -l /dev/disk/bu-uuid, </code>
    <ul>
      <li>disk information
    </ul>
  </li>
  <li><code>sudo useradd --create-home -G sudo,video --shell /bin/bash &lt;username&gt;</code>
    <ul>
      <li>adduser
    </ul>
  </li>
  <li><code>sudo passwd &lt;username&gt;</code>
    <ul>
      <li>change password
    </ul>
  </li>
  <li><code>groups</code>
      <ul>
            <li>check membership of groups</li>
      </ul>
  </li>
  <li><code>sudo usermod -a -G video achapman</code>
      <ul>
          <li>Adding achapman to video group</li>
          <li> <font color="red">need to log out and log back in</font></li>
      </ul>
  </li>
  <li><code>export KMDUMPISA=1</code>
    <ul>
        <li>dumping isa while compiling by exporting environment variable</li>
    </ul>
  </li>
  <li><code>export HCC_PROFILE=2</code>
    <ul>
        <li>list hip kernels at runtime</li>
    </ul>
  </li>
  <li><code>c++filt -n _ZN7rocblas13device_mallocEm</code>
    <ul>
        <li>extract c++ function name from mangled name</li>
    </ul>
  </li>
  <li><code>systemctl suspend</code>
    <ul>
      <li>suspend ubuntu terminal</li>
    </ul>
  </li>
  <li><code>export LD_LIBRARY_PATH=/opt/rocm/lib</code>
    <ul>
        <li>for message  libmcwamp_cpu.so: cannot open shared object file</li>
    </ul>
  </li>
  <li><code>/opt/rocm/bin/rocm_agent_enumerator</code>
      <ul>
          <li>to get device information</li>
      </ul>
  </li>
  <li><code>gsettings set org.gnome.desktop.wm.codeferences focus-mode 'mouse'</code>
    <ul>
      <li>focus follows mouse
    </ul>
  </li>
  <li><pre>Two changes to prevent terminal freeze</pre>
    <ul>
      <li>In the application <code>Software & Updates</code>,<br> 
          go to <code>Additional Drivers</code><br> 
          Under the <code>Unknown: Unknown</code> tag select the radio button for<br>
          <code>Using Processor microcode firmware 
            for AMD CPUs from amd64-microcode (proprietary)</code> 
      <li><code>sudo vim /etc/default/grub</code><br>
          Find the line <code>GRUB_CMDLINE_LINUX_DEFAULT="quiet splash"</code><br>
          change it to <code>GRUB_CMDLINE_LINUX_DEFAULT="quiet splash intel_idle.max_cstate=1"</code>
    </ul>
  </li>

</ul>

<h1>ROCm installation</h1>
<p>Instructions at <a href="https://rocm.github.io/ROCmInstall.html">ROCm</a>

<h1>VIM</h1>
<dl>
<dt>To substitute new line use \r. For example: </dt>
<dd><pre>1,$s/newline/\r/</pre></dd>

<dt>To insert tab when expandtab option is ON: </dt>
<dd><pre>i , &lt;CTRL&gt;&lt;v&gt; , &lt;tab&gt;  (i is for insert mode)</pre></dd>

<dt>Visual Block Mode: </dt>
<dd>Ctrl V, move cursor to highlight block, y or d (for yank or delete)</dd> 
<dd>move cursor to put block, p (for put)</dd>

<dt>split windows</dt>
<dd><table>
    <tr>
        <td><code> :split filename </code></td>
        <td> split window and load filename </td>
    </tr>
    <tr>
        <td><code> ctrl-w, ctrl-w </code></td>
        <td> move cursor to another window </td>
    </tr>
</table></dd> 
</dl>

<h1>Excel row-by-row conditional formatting</h1>
<p>Select (or high-light) the block of rows and columns
<p>Select &lt;HOME&gt;&lt;Conditional Formatting&gt;&lt;New Rule&lt;Use a formula to determine which cells to format&gt;
<p>To get the min values  =A1=MIN($A1:$C1)
<p>Select &lt;Format&gt;, choose a Fill color


<h1>GitBucket</h1>
<table>
<tr>
    <td>user.name</td>	<td>amcamd</td>
</tr><tr>
    <td>user.email</td>           <td>andrew.chapman@amd.com</td>
</tr>
</table>

<h1>GitHub</h1>
<table>
<tr>
    <td>user.name</td>	<td>amcamd</td>
</tr><tr>
    <td>user.email</td>           <td>andrew.chapman@amd.com</td>
</tr>
</table>

<h1>Useful Git commands</h1>
<h4>lola alias, add to ~/.gitrc</h4>
<pre>
[alias]
        lol = log --graph --decorate --pretty=oneline --abbrev-commit
        lola = log --graph --decorate --pretty=oneline --abbrev-commit --all
[color]
        branch = auto
        diff = auto
        interactive = auto
        status = auto
</pre>
<h4>Add modified and deleted files</h4>
<code>git add -u</code>
<h4>Undo the last commit</h4>
<ul>
    <li> <code>git reset --hard HEAD~1</code></li>
        <ul>
            <li>--hard discards changes</li>
        </ul>
    <li> <code>git reset --soft HEAD~1</code></li>
        <ul>
            <li>--soft preserves changes, and you may be able to <code>git stash</code> and <code>git stach pop</code> them.</li>
        </ul>
    <li><code>git push --force-with-lease</code>
</ul>

<h4>Get upstream branch into local repository then into origin</h4>
<ul>
    <li> <code>git fetch upstream</code></li>
    <li> <code>git checkout -b new_local_branch_name upstream/upstream_branch_name</code></li>
        <ul>
            <li>gets upstream_branch_name into local repository</li>
            <li>have only tried this where new_local_branch_name == upstream_branch_name</li>
        </ul>
    <li> <code>git push -u origin new_local_branch_name</code></li>
        <ul>
            <li>pushes new_local_branch_name from local repository to origin</li>
        </ul>
    <li><code>git push --force-with-lease</code>
</ul>

<h4>Configuring a remote for a fork</h4>
<ul>
<li><pre>
===: git remote -v
<samp>
origin	https://github.com/amcamd/rocBLAS.git (fetch)
origin	https://github.com/amcamd/rocBLAS.git (push)
</samp></pre>

<li><pre>
===: git remote add upstream https://github.com/ROCmSoftwarePlatform/rocBLAS
</pre>

<li><pre>
===: git remote -v
<samp>
origin	https://github.com/amcamd/rocBLAS.git (fetch)
origin	https://github.com/amcamd/rocBLAS.git (push)
upstream	https://github.com/ROCmSoftwarePlatform/rocBLAS (fetch)
upstream	https://github.com/ROCmSoftwarePlatform/rocBLAS (push)
</samp>
</pre>
</ul>


<h4>Syncing a fork</h4>
<ul>

<li><pre>
===: git fetch upstream
<samp>
remote: Counting objects: 1, done.
remote: Total 1 (delta 0), reused 0 (delta 0), pack-reused 0
Unpacking objects: 100% (1/1), done.
From https://github.com/ROCmSoftwarePlatform/rocBLAS
 * [new branch]      develop    -> upstream/develop
 * [new branch]      master     -> upstream/master
</samp></pre>

<li><pre>
===: git checkout develop
<samp>
Already on 'develop'
Your branch is up-to-date with 'origin/develop'.
</samp></pre>

<li>Alternative 1<pre>
===: git merge upstream/develop
<samp>
Updating db0918e..e4bd4ae
Fast-forward
</samp></pre>

<li>Alternative 2:
<pre>
===: git rebase upstream/develop develop
<samp>
First, rewinding head to replay your work on top of it...
Fast-forwarded develop to upstream/develop.
</samp></pre>

<li>Alternative 3, Merge strategy favors upstream/develop:
<pre>
===: git rebase -s recursive -X ours upstream/develop develop
</pre>

<li>To get changes from local copy back into origin/develop:
<pre>
===: git push
</pre>
</ul>

<h4>Patch</h4>
<ul>
<li>To generate a patch from the topmost n commits from a specific sha1 hash:
<pre>
===:git format-patch -&lt;n&gt; &lt;SHA1&gt;
</pre>

<li>for example to generate a patch from the most recent commit to HEAD:
<pre>
===:git format-patch -1 HEAD
</pre>

<li>To check a patch and then apply it without committing changes:
<pre>
===: git apply --check name.patch
===: git apply name.patch
</pre>

<li>To reverse the patch:
<pre>
===: git apply --reverse name.patch
</pre>
</ul>

<h4>Revert</h4>
<ul>
<li><code>git revert &lt;oldest_commit_hash&gt;..&lt;latest_commit_hash&gt; </code>

<li>A solution that keeps no traces of the "undo". NOTE: don't do this 
if someone allready pulled your change (I would use this only on my personal repo)
<pre>
git reset &lt;previous label or sha1&gt;
</pre>

<li>this will re-checkout all the updates locally (so git status will 
list all updated files). Then you "do your work" and re-commit your 
changes (Note: this step is optional)
<pre>
git commit -m "blabla"
</pre>

<li>At this moment your local tree differs from the remote. The following
will push and force remote to consider this push and remove the previous one:
<pre>
git push -f
</pre>


<li>!! watch-out some tags may still be pointing removed commit !!
</ul>

<h4>Merge or "squash" multiple commits into one</h4>
<ul>
<li>To list commits: <code>git log --pretty=oneline</code>

<li>To merge last 5 commits: <code>git rebase -i HEAD~5</code>

<li>In editor change all but oldest commit from pick to squash. 
<li>Quit editor, and add commit 
comment in next editor. 
<li>If you have already pushed commits then force push with:

<pre>git push --force-with-lease    (or git push origin branch-name --force-with-lease)</pre>
</ul>


<h4>pull request from cherry-pick commit</h4>

<p>See link for rebase after cherry-pick 
<ul>
    <li><a href="https://davitenio.wordpress.com/2008/09/27/git-merge-after-git-cherry-pick-avoiding-duplicate-commits/">git merge after git cherry-pick</a></li>
    <li><a href="https://stackoverflow.com/questions/14486122/how-does-git-merge-after-cherry-pick-work">How does git merge after cherry-pick work</a></li>
</ul>

<p>You need to basically create a new branch upstreamDevelop & cherry-pick the commits you want to add to it.

<pre>git remote add upstream &lt;git repository&gt;</pre>

<pre>git remote update</pre>

<p>create new branch upstreamDevelop that is copy of upstream/develop
<pre>git checkout -b upstreamDevelop upstream/develop</pre>

<p>get the commit (or commits) you want
<pre>git cherry-pick &lt;SHA hash of commit&gt;</pre>

<p>to push the new branch upstreamDevelop to origin</pre>
<pre>git push origin upstreamDevelop</pre>

<p>You will now see new branch upstreamDevelop in your "origin" repositiory at githup

<h4>Changing a commit message</h4>
<p>For the latest commit
<ul>
<li><code>git commit --amend</code>
<li>If commit has been pushed, force push with:  <code>git push --force-with-lease</code>
</ul>

<p>For an older commit, say second last
<ul>
<li><code>git rebase -i HEAD~2</code>
<li>change the text from <code>pick</code> to <code>edit</code> in the message you want to change
<li>Then:
<ul>
<li><code>git commit --amend</code>

<li><code>git rebase --continue</code>
<li>you will likely also need <code>git push --force-with-lease</code>
</ul>
</ul>

<h4>Merge rocBLAS develop into master and release</h4>
<ul>
    <li> <code>mkdir -p ~/repos/rocBLASmergeDevelop; cd ~/repos/rocBLASmergeDevelop</code></li>

    <li> <code>git clone https://github.com/ROCmSoftwarePlatform/rocBLAS.git</code></li>

    <li> <code>cd rocBLAS</code></li>
    <li> <code>git checkout develop</code></li>
    <li> edit both bump_develop_version.sh and bump_master_version.sh</li>
    <li> <code>./bump_master_version.sh</code></li>
    <ul>
        <li> check changes are correct with    <code>git status</code> and look at CMakeLists.txt and other files.</li>
        <li> <code> git add -u</code></li>
        <li> <code>git commit -m"version for master branch release"</code></li>
    </ul>

    <li> <code>git checkout master</code></li>
    <li> <code>git merge develop</code></li>
    <li> <code>git checkout develop</code></li>
    <li> <code>git merge master --ff-only</code>  # getting the develop branch to include the new merge commit</li>

    <li> <code>./bump_develop_version.sh</code></li>
    <ul>
        <li> check changes are correct with    <code>git status</code> and look at CMakeLists.txt and other files.</li>
        <li> <code> git add -u</code></li>
        <li> <code>git commit -m"version for develop branch release"</code></li>
    </ul>

    <li> <code>git push --all</code></li>

    <li> go to  https://github.com/ROCmSoftwarePlatform/rocBLAS.git</li>

    <li> under repository name click &lt;Releases&gt;</li>

    <li> click &lt;Draft a new release&gt;</li>
    <ul>
        <li> select MASTER branch</li>
        <li>enter <a href="http://semver.org">Semantic Versioning</a> version tag</li>
        <li>enter Title and notes</li>
        <li>add .deb and .rpm files from Jenkins. 
            You may need to use Chrome browser in place of Firefox for adding .deb and .rpm.</li>
        <li> click &lt;Publish release&gt;</li>
    </ul>
</ul>

<h4>Merge Tensile develop into master and release</h4>
<ul>
    <li> <code>mkdir -p ~/repos/Tensile_merge_develop; cd ~/repos/Tensile_merge_develop</code></li>

    <li> <code>git clone https://github.com/ROCmSoftwarePlatform/Tensile.git</code></li>

    <li> <code>cd Tensile</code></li>
    <li> <code>git checkout develop</code></li>
    <li> edit bump-version.h</li>
    <li> <code>./bump-version.sh</code></li>
    <ul>
        <li> check to see that Tensile/__init__.py has changed</li>
        <li> check version in .yaml files with  <code>grep MinimumRequiredVersion Tensile/Configs/*yaml</code></li>
        <li> <code>git add -u</code></li>
        <li> <code>git commit -m"change version for new release"</code></li>
    </ul>

    <li> <code>git checkout master</code></li>
    <li> <code>git merge develop</code></li>
    <li> <code>git checkout develop</code></li>
    <li> <code>git merge master --ff-only  # getting the develop branch to include the new merge commit</code></li>
    <li> check that there is the correct Tensile/__init__.py in develop and master</li>

    <li> <code>git push --all</code></li>

    <li> go to  https://github.com/ROCmSoftwarePlatform/Tensile.git</li>

    <li> under repository name click &lt;Releases&gt;</li>

    <li> click &lt;Draft a new release&gt;</li>
    <ul>
        <li> select MASTER branch</li>
        <li>enter <a href="http://semver.org">Semantic Versioning</a> version tag</li>
        <li>enter Title and notes</li>
        <li>add .deb and .rpm files from Jenkins.
            You may need to use Chrome browser in place of Firefox for adding .deb and .rpm.</li>
        <li> click &lt;Publish release&gt;</li>
    </ul>
</ul>

<h4>Merge hipBLAS develop into master and release</h4>
<ul>
    <li> <code>mkdir -p ~/repos/hipBLASmergeDevelop; cd ~/repos/hipBLASmergeDevelop</code></li>

    <li> <code>git clone https://github.com/ROCmSoftwarePlatform/hipBLAS.git</code></li>

    <li> <code>cd hipBLAS</code></li>
    <li> <code>git checkout develop</code></li>
    <li> edit both bump_develop_version.sh and bump_master_version.sh</li>
    <li> <code>./bump_master_version.sh</code></li>
    <ul>
        <li> check changes are correct with    <code>git status</code> and look at CMakeLists.txt and other files.</li>
        <li> <code> git add -u</code></li>
        <li> <code>git commit -m"version for master branch release"</code></li>
    </ul>

    <li> <code>git checkout master</code></li>
    <li> <code>git merge develop</code></li>
    <li> <code>git checkout develop</code></li>
    <li> <code>git merge master --ff-only</code>  # getting the develop branch to include the new merge commit</li>

    <li> <code>./bump_develop_version.sh</code></li>
    <ul>
        <li> check changes are correct with    <code>git status</code> and look at CMakeLists.txt and other files.</li>
        <li> <code> git add -u</code></li>
        <li> <code>git commit -m"version for develop branch release"</code></li>
    </ul>

    <li> <code>git push --all</code></li>

    <li> go to  https://github.com/ROCmSoftwarePlatform/hipBLAS.git</li>

    <li> under repository name click &lt;Releases&gt;</li>

    <li> click &lt;Draft a new release&gt;</li>
    <ul>
        <li> select MASTER branch</li>
        <li>enter <a href="http://semver.org">Semantic Versioning</a> version tag</li>
        <li>enter Title and notes</li>
        <li>add .deb and .rpm files from Jenkins. 
            You may need to use Chrome browser in place of Firefox for adding .deb and .rpm.</li>
        <li> click &lt;Publish release&gt;</li>
    </ul>
</ul>


<h1>Useful commands</h1>
<p>find ./rocBLAS-develop -type f -exec grep -l gemv {} \; 


<h1>Timing with C++11</h1>
<pre>
#include &lt;chrono&gt;
  std::chrono::time_point&lt;std::chrono::high_resolution_clock&gt; start, end;
  std::chrono::duration&lt;double&gt;dur;
  hipDeviceSynchronize();
  start = std::chrono::high_resolution_clock::now();
    status = hcblasSgemm(handle, typeA, typeB, M, N, K, &amp;alpha, 
    d_A, lda, d_B, ldb, &amp;beta, d_C, ldc);
  hipDeviceSynchronize();
  end = std::chrono::high_resolution_clock::now();
  dur = end - start;
  double gemmSec= dur.count();

  printf("dur, gemmSec = %f, %f\n",dur, gemmSec);
  double gflops = (double)(M) * (double)(N) * (double)(K) * 2.0 / gemmSec / 1e9;
  printf("gflops = %f\n",gflops);


Alternative explicit cast to microseconds. Do not cast to seconds for jobs
running for &lt; 1sec, because it truncates so you will loose all precition
less than one second.
  double gemmSec2= chrono::duration_cast&lt;chrono::microseconds&gt;(end - start).count();

</pre>
The event timer can also be used. It gives results similar to C++11 chrono.
<pre>
#include &lt;hip/hip_runtime.h&gt;
#include &lt;hip/hip_runtime_api.h&gt;

  hipEvent_t hipStart, hipStop;
  hipEventCreate(&hipStart);
  hipEventCreate(&hipStop);

  hipEventRecord(hipStart);

  hipEventRecord(hipStop);

  float milliseconds = 0;
  hipEventElapsedTime(&milliseconds, hipStart, hipStop);

</pre>


<h1>ATITOOL (atitool)</h1>

<ul>
    <li>get atitool from
        <ul>
            <li><a href="http://gpudiagnostics/release">http://gpudiagnostics/release</a>
            <li>Click <code>diagnostic tools</code> button at top
            <li>Click <code>ATITool</code> link on left panel, download latest release
        </ul>
    <li>put fan on full
        <ul>
            <li><code>sudo ./atitool -fancontrol=1</code>
        </ul>

    <li>set clock to 1500MHz
        <ul>
            <li>set soc voltage first
                <ul>
                    <li><code>sudo ./atitool --vddcr_soc=1.1</code>
                </ul>
            <li>set clock
                <ul>
                    <li><code>sudo ./stitool --eng=1500</code>
                </ul>
        </ul>

    <li>disable DPM
        <ul>
            <li>sudo vi /etc/default/grub
            <li>add value <code>amdgpu.dpm=0"</code> to <code>GRUB_CMDLINE_LINUX_DEFAULT</code>
            <li><code>sudo update-grub</code>
            <li>restart your system</li>
        </ul>
</ul>



<h1>rocm-smi  (ROCm System Management Interface</h1>
<p>Run <code>rocm-smi --help</code> for information. Below commands set
the device 1 clock to level 7 (1000 Hz) before a command, and then resets to
default after command.
<pre>
rocm-smi -d 1 --setsclk 7
sleep 1
rocm-smi -d 1 -g

./rocblas_sgemm_example

#reset device 1 clock to default values
rocm-smi -d 1 -r
</pre>

<h1>Single user runlevel N S</h1>
<p>
The command <pre>runlevel</pre> will show the runlevel. To boot the machine in runlevel N S
edit /etc/default/grub to change from

<pre>
GRUB_CMDLINE_LINUX_DEFAULT="quiet splash"
#GRUB_TERMINAL=console
#GRUB_GFXMODE=640x480
</pre>

to 

<pre>
GRUB_CMDLINE_LINUX_DEFAULT="text single"
GRUB_TERMINAL=console
GRUB_GFXMODE=640x480
</pre>

Then run <pre>sudo update-grub</pre> Reboot, and the machine should come up with runlevel N S.
Reverse the changes to get back to runlevel N 2.
<p>
For Ubuntu 16 see
<a href="http://askubuntu.com/questions/788323/change-runlevel-on-16-04">http://askubuntu.com/questions/788323/change-runlevel-on-16-04</a><br>


<h1>Docker</h1>
Docker containers used in Jenkins.
<ul>
    <li><a href="http://compute-artifactory/artifactory/webapp/#/artifacts/browse/tree/General/rocm-docker-github/rocm-developer-tools/hip/master/hip-hcc-ctu-ubuntu-16.04/latest">Artifactory Docker for hip-hcc and hip-hcc-ctu</a><br></td>

    <li><a href="https://hub.docker.com/r/rocm/rocm-terminal/tags/">Released Docker for rocm/rocm-terminal</a><br></td>
</ul>
<p>Docker contailers for ROC MASTER, ROCm release
<ul>
	<li><a href="http://confluence.amd.com/display/MLSE/DockerImages">roc-master DockerImages</a></li>
	<li><a href="http://confluence.amd.com/pages/viewpage.action?spaceKey=GPUCPT&title=Compute+roc+master">Compute roc master</a></li>
	<li><a href="http://confluence.amd.com/display/GPUCPT/Docker+images+for+ROCm+releases">Docker images for ROCm releases</a></li>
</ul>
<p>On Ubuntu machine, can log in with
<ul>
	<li><code>sudo docker login</code></li>
	<li> https://hub.docker.com  account is   amcamd</li>
</ul>
<p>To see all available docker images on machine 
<ul>
	<li><code>sudo docker images</code></li>
</ul>
</p>
<p>To see all running docker containers
<ul>
	<li>sudo docker ps -a</li>
</ul>
</p>
<p>For the error message below
<ul>
	<li><code>error creating overlay mount to /var/lib/docker/overlay2/...N.../merged: no such file or directory</code></li>
</ul>
<p>Try the following commands
<ul>
    <li><code>docker system df</code></li>
    <li><code>docker system prune</code></li>
    <li><code>docker system prune -a</code></li>
</ul></p>
<p>To attach to docker container
<ul>
	<li><code>sudo docker attach &lt;docker number&gt;</code></li>
</ul></p>
<p>To pull docker image sunway13/ubuntu14.04:promote-free-v2
<ul>
	<li><code>sudo docker pull sunway513/ubuntu14.04:promote-free-v2</code></li>
</ul></p>
<p>To run docker image sunway13/ubuntu14.04:promote-free-v2
<ul>
	<li><code>sudo docker run -it --rm --device "/dev/kfd" --device "/dev/dri" --group-add video sunway513/ubuntu14.04:promote-free-v2</code></li>
</ul></p>
<p>To remove a docker container, first get CONTAINER ID with 
<ul>
	<li><code>sudo docker ps -a</code></li>
	<li>Next use command <code>docker rm &lt;CONTAINER ID&gt;</code></li>
</ul></p>

<p>To connect to a running docker container

<ul>
    <li> first get <code>container</code> with: <code>sudo docker ps</code></li>
    <li> next use: <code>docker exec -e COLUMNS="`tput cols`" -e LINES="`tput lines`" -ti container /bin/bash</code></li>
</ul>

<p>to copy a file to a docker container
<ul>
    <li> first get <code>container</code> with: <code>sudo docker ps</code></li>
    <li> next get <code>ID</code> with: <code>sudo docker inspect -f   '{{.Id}}' container</code></li>
    <li> copy file with: <code> sudo docker cp file_name ID:file_path_in_container</code></li>
</ul>

<h3>To commit a docker image as: sunway513/hipcaffe:rocblas</h3>
<pre>In another terminal on the host machine find the docker image #ID with: sudo docker ps

Commit the image ID with:
sudo docker commit #ID sunway513/hipcaffe:rocblas

Push to dockerhub repo with:
sudo docker push sunway513/hipcaffe:rocblas
</pre>

<h3>To open docker on jenkins-cuda-0</h3>

sudo docker run -it -u 1000:1000 --device=/dev/nvidiactl --device=/dev/nvidia0 --device=/dev/nvidia-uvm --device=/dev/nvidia-uvm-tools --volume-driver=nvidia-docker --volume=nvidia_driver_384.90:/usr/local/nvidia:ro  hipblas/build-hipblas-hip-artifactory:latest

<h3>To install hip on cuda machine</h3>
<pre>
wget -qO - http://packages.amd.com/rocm/apt/debian/rocm.gpg.key | sudo apt-key add -
sudo sh -c 'echo deb [arch=amd64] http://packages.amd.com/rocm/apt/debian/ xenial main > /etc/apt/sources.list.d/rocm.list'

sudo apt-get install hip_nvcc
</pre>
To get the developer-preview branch
<pre>
git clone -b developer-preview https://github.com/GPUOpen-ProfessionalCompute-Tools/HIP.git
cd HIP && mkdir build && cd build && cmake .. && sudo make install
</pre>

<h3>To install OpenCL</h3>

<p>Commands below are from the
<a href="https://github.com/RadeonOpenCompute/ROCm">ROCm site</a><br>

<pre>sudo apt-get install rocm rocm-opencl</pre>

<pre>sudo apt-get install rocm-opencl-dev</pre>

<h1>Artifactory</h1>

<p>
http://compute-artifactory.amd.com/artifactory/webapp/#/artifacts/browse/tree/General/deb-experimental-local
<p>
http://compute-artifactory.amd.com/artifactory/webapp/#/artifacts/browse/tree/General/rocm-docker-github/kknox/hcc/clang_tot_upgrade/hcc-lc-ubuntu-16.04

<p>
edit /etc/apt/sources.list.d/rocm.list

<p>
change
deb [arch=amd64] http://packages.amd.com/rocm/apt/debian/ xenial main

<p>
to something like
deb [arch=amd64] http://compute-artifactory.amd.com/rocm/apt/debian/ xcnial 
<p>
or
<p>
http://compute-artifactory.amd.com/artifactory/webapp/#/artifacts/browse/tree/General/rocm-release-1.6-deb/amd/rocm
<p>
or
<p>
deb [arch=amd64] http://compute-artifactory.amd.com/artifactory/list/rocm-release-1.6-deb/ xenial main
<p>
or
<p>
deb [arch=amd64] http://10.255.8.5/rocm/apt/debian/ xenial main

<h1>clang-format</h1>
<ul>
    <li><a href="https://dx13.co.uk/articles/2015/4/3/Setting-up-git-clang-format.html">Setting up git-clang-format</a><br></li>
    <li><a href="https://clang.llvm.org/docs/ClangFormatStyleOptions.html">clang-format style options</a><br></li>
    <li><a href="http://clang.llvm.org/docs/ClangFormat.html#vim-integration">clang-format VIM integration</a><br></li>
</ul>
<ul>
    <li>install clang-format with: <code>sudo apt-get update; sudo apt-get install clang-format</code></li>
    <li><a href="https://llvm.org/svn/llvm-project/cfe/trunk/tools/clang-format/git-clang-format">Download git-clang-format from here</a><br></li>
    <li>make it executable with chmod +x ~/bin/git-clang-format</li>
    <li>check its been picked pu by git: <code>git clang-format -h</code></li>
    <li>Try it out with <code>git clang-format --diff</code></li>
</ul>
<ul>
    <li> To format a file: <code>clang-format-3.8 -style=file -i <path_to_source_file></code>
    <li> To format at checkin: <code>./.githooks/install</code>
</ul>

<h1>Visual Studio Code</h1>
<ul>
    <li>to start, click on icon, or search for "Visual Studio Code"
    <li>directory .vscode is added
    <li>gear wheel brings up .vscode/launch.json file. Add the following to configurations in .vscode/launch.json</li>
    <li><pre> "args": [
                "./Tensile/Tensile/Configs/rocblas_sgemm_asm_single_kernel.yaml", "~/tensile-gen"
            ]</pre></li>
    <li>bug icon brings up debug view</li>
    <li>you need to be viewing the file Tensile.py when you start debugging</li>
</ul>

<h1>Downgrade Linux Kernel</h1>
<ul>
    <li>To get to grub menue press <code>Esc</code> or <code>Shift</code> while rebooting
    </li><li>select: Advanced options for Ubuntu
    </li><li>In grub menue, select previous kernel, and note names of more recent kernels
    </li><li>To make it easier to get to grub menue:
    <pre><code>sudo vim /etc/default/grub</code>
          comment out the lines 
          #GRUB_HIDDEN_TIMEOUT=0
          #GRUB_HIDDEN_TIMEOUT_QUIET=true
          run grub-update to update grub after editing
        </pre>
    </li><li>To list kernels: <code>dpkg -l | grep linux</code>
    </li><li>To remove kernels, follow steps below to purge header and image:
        <pre>
<code>sudo apt-get purge linux-headers-4.15.0-29-generic</code>
<code>sudo apt-get purge linux-image-4.15.0-29-generic</code>
        </pre>
    </li><li>To disable kernel updates:
<pre>
<code>sudo apt-mark hold linux-headers-4.13.0-45-generic linux-image-4.13.0-45-generic linux-image-extra-4.13.0-45-generic</code>
</pre>
    </li><li>To enable kernel updates:
<pre>
<code>sudo apt-mark unhold linux-headers-4.13.0-45-generic linux-image-4.13.0-45-generic linux-image-extra-4.13.0-45-generic</code>
</pre>
    </li><li> To see all packages on hold: <code>apt-mark showhold</code>
    </li>
</ul>

<h1>Upgrade ROCm</h1>
<pre>
# you can check gpg key with
apt-key list

# if ROCm Release Manager key has expired,  update gpg key with
wget -qO - http://repo.radeon.com/rocm/apt/debian/rocm.gpg.key | sudo apt-key add -
echo 'deb [arch=amd64] http://repo.radeon.com/rocm/apt/debian/ xenial main' | sudo tee /etc/apt/sources.list.d/rocm.list

sudo apt update
sudo apt -y autoremove rocm-dkms
# I don't think hee next four did anything, but it's worth a shot to make sure all old installations were purged
sudo apt purge hsakmt-roct
sudo apt purge hakmt-roct-dev
sudo apt purge compute-firmware
sudo apt purge $(dpkg -l | grep 'kfd\|rocm' | grep linux | grep -v libc | awk '{print $2}')

#This was required
sudo dkms remove rock/1.7.137-ubuntu --all
sudo apt upgrade
sudo reboot

# After the reboot
sudo apt -y install rocm-dkms
echo 'ADD_EXTRA_GROUPS=1' | sudo tee -a /etc/adduser.conf
echo 'EXTRA_GROUPS=video' | sudo tee -a /etc/adduser.conf
echo 'export PATH=$PATH:/opt/rocm/bin:/opt/rocm/profiler/binop/rocm/opencl/bin/x86_64' | sudo tee -a /etc/profile.d/rocm.sh

# you may need to add the following line to /etc/modprobe.d/amd.conf or /etc/modprobe.d/dkms.conf
options amdgpu exp_hw_support=1
# and sudo reboot

</pre>

<h1>Doxygen</h1>
<p><a href="http://www.doxygen.nl/manual/index.html">Doxygen manual, with information on formatting</a><br>
<dl>

    <dt>To install Doxygen:</dt>
    <dd><code>sudo apt-get install doxygen</code></dd>

    <dt>To generate documentation for source code</dt>
    <dd> <code>doxygen -g sample_text.conf</code></dd>

    <dt>To produce Doxygen output for a single file include/rocblas-functions.h:</dt>
    <dd><code>( cat sample_text.conf ; echo "INPUT=include/rocblas-functions.h" ) | doxygen -</code></dd>
</dl>
</p>

</body>
</html>
